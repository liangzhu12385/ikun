<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨è€å¸ˆè¯¾å ‚ç§¯åˆ†ç³»ç»Ÿ</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .search-box {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 200px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        
        th {
            background-color: #3498db;
            color: white;
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        tr:hover {
            background-color: #e6f7ff;
        }
        
        .points-input {
            width: 50px;
            padding: 5px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        
        .add-points {
            background-color: #2ecc71;
        }
        
        .subtract-points {
            background-color: #e74c3c;
        }
        
        .reset-points {
            background-color: #f39c12;
        }
        
        .export-excel {
            background-color: #27ae60;
        }
        
        .total-points {
            font-weight: bold;
        }
        
        .positive-points {
            color: #27ae60;
        }
        
        .negative-points {
            color: #e74c3c;
        }
        
        .zero-points {
            color: #7f8c8d;
        }
        
        .rankings-container {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }
        
        .ranking-section {
            flex: 1;
            padding: 15px;
            background-color: #eaf7ff;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }
        
        .ranking-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
            border-bottom: 1px solid #3498db;
            padding-bottom: 5px;
        }
        
        .student-rank {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.7);
        }
        
        .rank-1 {
            background-color: #ffd700;
            font-weight: bold;
        }
        
        .rank-2 {
            background-color: #c0c0c0;
            font-weight: bold;
        }
        
        .rank-3 {
            background-color: #cd7f32;
            font-weight: bold;
        }
        
        .top-10 {
            background-color: #e6f7ff;
        }
        
        .rank-number {
            font-weight: bold;
            margin-right: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background-color: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .medal {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .gold {
            background-color: gold;
            border-radius: 50%;
        }
        
        .silver {
            background-color: silver;
            border-radius: 50%;
        }
        
        .bronze {
            background-color: #cd7f32;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ¨è€å¸ˆè¯¾å ‚ç§¯åˆ†ç³»ç»Ÿ</h1>
        
        <div class="controls">
            <div>
                <input type="text" class="search-box" id="searchBox" placeholder="æœç´¢å­¦ç”Ÿå§“å...">
                <button id="searchBtn">æœç´¢</button>
                <button id="resetSearchBtn">é‡ç½®</button>
            </div>
            <div>
                <button id="saveDataBtn">ä¿å­˜æ•°æ®</button>
                <button id="loadDataBtn">åŠ è½½æ•°æ®</button>
                <button id="exportExcelBtn" class="export-excel">å¯¼å‡ºExcel</button>
                <button id="resetAllBtn">é‡ç½®æ‰€æœ‰ç§¯åˆ†</button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="students">å­¦ç”Ÿåˆ—è¡¨</div>
            <div class="tab" data-tab="rankings">ç§¯åˆ†æ’è¡Œæ¦œ</div>
        </div>
        
        <div class="tab-content active" id="studentsTab">
            <table id="studentsTable">
                <thead>
                    <tr>
                        <th>åºå·</th>
                        <th>å§“å</th>
                        <th>å½“å‰ç§¯åˆ†</th>
                        <th>åŠ åˆ†</th>
                        <th>å‡åˆ†</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="studentsTableBody">
                    <!-- å­¦ç”Ÿæ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <div class="tab-content" id="rankingsTab">
            <div class="rankings-container">
                <div class="ranking-section">
                    <div class="ranking-title">ğŸ† å‰ååæ’è¡Œæ¦œ</div>
                    <div id="top10List">
                        <!-- å‰ååå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="ranking-section">
                    <div class="ranking-title">ğŸ“Š å®Œæ•´æ’è¡Œæ¦œ</div>
                    <div id="fullRankingList" style="max-height: 500px; overflow-y: auto;">
                        <!-- å®Œæ•´æ’è¡Œæ¦œå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script>
        // å­¦ç”Ÿåå•
        const students = [
            "é™ˆæ˜æ­£", "é™ˆæ·™æ˜", "ä½•å˜‰å³°", "ç›˜å·§æ£‹", "å‡Œé¢¢å…ƒ", 
            "å§œå“è‰º", "éƒ‘ç¾½æ™—", "é»„æµ©å¤©", "å¶æ½‡ç›ˆ", "ç‹é›ª", 
            "ç®€ä¸¹", "é»„å©§", "è´ºæ˜€é¦¨", "é™ˆå®¶æ¬£", "å½­å˜‰ç’", 
            "å†¯å®‡å‡¤", "å¶æµ©æ¬£", "å¢è£•å…ƒ", "å®‹å»ºæ°¸", "å¶å­å¥", 
            "åˆ˜è”æ˜", "è‚–å¯æ¬£", "è‚–ç‘ä»ª", "é’Ÿå®¶èŒµ", "çºªæ±ä½³", 
            "åˆ˜å®£å½¤", "éƒ­æ¥ ", "è°­å©‰çª", "éƒ‘ä¹ç¥º", "é™ˆè¯­è", 
            "æœ±èƒœèª", "é»„æ€æ€¡", "æ¢é•‡å°§", "å´é¦¥ç¾½", "æ—æ­£ç¿°", 
            "é™ˆå¯å¦®", "ç¬¦è´µç‘œ", "å¼ é›¨", "ææƒ³", "æ¨ä¸½æ¶µ", 
            "èƒ¡è‹æ¡ƒ", "ä¸ç‰è¹", "æ˜“å®‡æ¬£", "å”å˜‰ç¿", "ç‹å¤©æ…§", 
            "å­™å¹¿çš“", "æ¨ä½³é¢–", "å­™ä»™ä»™", "é™ˆæ±‰ç‘œ", "ç™½æˆä¼š", 
            "å‘ç‰å®‰", "å¤åŠ›å­™Â·è‚‰å­œ", "ç´¢æœ—å“ç›", "é»å˜‰æ˜", "æ¢é›…æ™´", 
            "ç‹å‘¨æ¬£", "å´è¯—çª", "å†¯çƒ¨çª", "è¢æµ©"
        ];
        
        // åˆå§‹åŒ–å­¦ç”Ÿç§¯åˆ†æ•°æ®
        let studentData = {};
        students.forEach(student => {
            studentData[student] = 0;
        });
        
        // DOMå…ƒç´ 
        const studentsTableBody = document.getElementById('studentsTableBody');
        const searchBox = document.getElementById('searchBox');
        const searchBtn = document.getElementById('searchBtn');
        const resetSearchBtn = document.getElementById('resetSearchBtn');
        const saveDataBtn = document.getElementById('saveDataBtn');
        const loadDataBtn = document.getElementById('loadDataBtn');
        const exportExcelBtn = document.getElementById('exportExcelBtn');
        const resetAllBtn = document.getElementById('resetAllBtn');
        const top10List = document.getElementById('top10List');
        const fullRankingList = document.getElementById('fullRankingList');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // è·å–ç§¯åˆ†æ˜¾ç¤ºç±»å
        function getPointsClass(points) {
            if (points > 0) return 'positive-points';
            if (points < 0) return 'negative-points';
            return 'zero-points';
        }
        
        // æ¸²æŸ“å­¦ç”Ÿè¡¨æ ¼
        function renderStudentsTable(filter = '') {
            studentsTableBody.innerHTML = '';
            let filteredStudents = students;
            
            if (filter) {
                filteredStudents = students.filter(student => 
                    student.includes(filter)
                );
            }
            
            filteredStudents.forEach((student, index) => {
                const row = document.createElement('tr');
                const pointsClass = getPointsClass(studentData[student]);
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${student}</td>
                    <td class="total-points ${pointsClass}">${studentData[student]}</td>
                    <td><input type="number" class="points-input" id="add-${student}" value="1" min="1"></td>
                    <td><input type="number" class="points-input" id="subtract-${student}" value="1" min="1"></td>
                    <td>
                        <button class="add-points" data-student="${student}">åŠ åˆ†</button>
                        <button class="subtract-points" data-student="${student}">å‡åˆ†</button>
                        <button class="reset-points" data-student="${student}">é‡ç½®</button>
                    </td>
                `;
                
                studentsTableBody.appendChild(row);
            });
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.querySelectorAll('.add-points').forEach(btn => {
                btn.addEventListener('click', function() {
                    const student = this.getAttribute('data-student');
                    const points = parseInt(document.getElementById(`add-${student}`).value) || 1;
                    studentData[student] += points;
                    renderStudentsTable(searchBox.value);
                    updateRankings();
                });
            });
            
            document.querySelectorAll('.subtract-points').forEach(btn => {
                btn.addEventListener('click', function() {
                    const student = this.getAttribute('data-student');
                    const points = parseInt(document.getElementById(`subtract-${student}`).value) || 1;
                    studentData[student] -= points; // å…è®¸å‡åˆ°è´Ÿæ•°
                    renderStudentsTable(searchBox.value);
                    updateRankings();
                });
            });
            
            document.querySelectorAll('.reset-points').forEach(btn => {
                btn.addEventListener('click', function() {
                    const student = this.getAttribute('data-student');
                    if (confirm(`ç¡®å®šè¦é‡ç½® ${student} çš„ç§¯åˆ†å—ï¼Ÿ`)) {
                        studentData[student] = 0;
                        renderStudentsTable(searchBox.value);
                        updateRankings();
                    }
                });
            });
        }
        
        // æ›´æ–°æ’è¡Œæ¦œ
        function updateRankings() {
            // æŒ‰ç§¯åˆ†æ’åº
            const sortedStudents = Object.entries(studentData)
                .sort((a, b) => b[1] - a[1]);
            
            // æ›´æ–°å‰ååæ’è¡Œæ¦œ
            top10List.innerHTML = '';
            sortedStudents.slice(0, 10).forEach(([student, points], index) => {
                const rankItem = document.createElement('div');
                let medal = '';
                const pointsClass = getPointsClass(points);
                
                if (index === 0) medal = '<span class="medal gold"></span>';
                else if (index === 1) medal = '<span class="medal silver"></span>';
                else if (index === 2) medal = '<span class="medal bronze"></span>';
                
                rankItem.className = `student-rank ${index < 3 ? 'rank-' + (index + 1) : 'top-10'}`;
                rankItem.innerHTML = `
                    <div>
                        ${medal}
                        <span class="rank-number">${index + 1}.</span>
                        <span>${student}</span>
                    </div>
                    <span class="${pointsClass}">${points}åˆ†</span>
                `;
                top10List.appendChild(rankItem);
            });
            
            // æ›´æ–°å®Œæ•´æ’è¡Œæ¦œ
            fullRankingList.innerHTML = '';
            sortedStudents.forEach(([student, points], index) => {
                const rankItem = document.createElement('div');
                let medal = '';
                const pointsClass = getPointsClass(points);
                
                if (index === 0) medal = '<span class="medal gold"></span>';
                else if (index === 1) medal = '<span class="medal silver"></span>';
                else if (index === 2) medal = '<span class="medal bronze"></span>';
                
                rankItem.className = `student-rank ${index < 3 ? 'rank-' + (index + 1) : ''}`;
                rankItem.innerHTML = `
                    <div>
                        ${medal}
                        <span class="rank-number">${index + 1}.</span>
                        <span>${student}</span>
                    </div>
                    <span class="${pointsClass}">${points}åˆ†</span>
                `;
                fullRankingList.appendChild(rankItem);
            });
        }
        
        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveData() {
            localStorage.setItem('classPointsData', JSON.stringify(studentData));
            alert('ç§¯åˆ†æ•°æ®å·²ä¿å­˜ï¼');
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadData() {
            const savedData = localStorage.getItem('classPointsData');
            if (savedData) {
                studentData = JSON.parse(savedData);
                renderStudentsTable();
                updateRankings();
                alert('ç§¯åˆ†æ•°æ®å·²åŠ è½½ï¼');
            } else {
                alert('æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„æ•°æ®ï¼');
            }
        }
        
        // å¯¼å‡ºExcelæ–‡ä»¶
        function exportToExcel() {
            // å‡†å¤‡æ•°æ®
            const data = [
                ["åºå·", "å§“å", "ç§¯åˆ†"], // è¡¨å¤´
                ...Object.entries(studentData)
                    .sort((a, b) => b[1] - a[1]) // æŒ‰ç§¯åˆ†æ’åº
                    .map(([name, points], index) => [index + 1, name, points]) // è½¬æ¢ä¸ºè¡¨æ ¼è¡Œ
            ];
            
            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(data);
            
            // è®¾ç½®åˆ—å®½
            ws['!cols'] = [
                { wch: 8 },  // åºå·åˆ—å®½
                { wch: 20 }, // å§“ååˆ—å®½
                { wch: 10 }  // ç§¯åˆ†åˆ—å®½
            ];
            
            // æ·»åŠ å·¥ä½œè¡¨åˆ°å·¥ä½œç°¿
            XLSX.utils.book_append_sheet(wb, ws, "è¯¾å ‚ç§¯åˆ†");
            
            // ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½
            const date = new Date();
            const fileName = `æ¨è€å¸ˆè¯¾å ‚ç§¯åˆ†_${date.getFullYear()}å¹´${date.getMonth()+1}æœˆ${date.getDate()}æ—¥.xlsx`;
            XLSX.writeFile(wb, fileName);
        }
        
        // é‡ç½®æ‰€æœ‰ç§¯åˆ†
        function resetAllPoints() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å­¦ç”Ÿçš„ç§¯åˆ†å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                students.forEach(student => {
                    studentData[student] = 0;
                });
                renderStudentsTable();
                updateRankings();
            }
        }
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // æ›´æ–°æ´»åŠ¨æ ‡ç­¾
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // æ›´æ–°æ´»åŠ¨å†…å®¹
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === tabId + 'Tab') {
                        content.classList.add('active');
                    }
                });
            });
        });
        
        // äº‹ä»¶ç›‘å¬
        searchBtn.addEventListener('click', () => {
            renderStudentsTable(searchBox.value);
        });
        
        resetSearchBtn.addEventListener('click', () => {
            searchBox.value = '';
            renderStudentsTable();
        });
        
        saveDataBtn.addEventListener('click', saveData);
        loadDataBtn.addEventListener('click', loadData);
        exportExcelBtn.addEventListener('click', exportToExcel);
        resetAllBtn.addEventListener('click', resetAllPoints);
        
        // åˆå§‹æ¸²æŸ“
        renderStudentsTable();
        updateRankings();
    </script>
</body>
</html>
